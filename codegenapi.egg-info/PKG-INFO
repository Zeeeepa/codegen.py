Metadata-Version: 2.4
Name: codegenapi
Version: 1.0.0
Summary: Python SDK and CLI for Codegen Agents
Home-page: https://github.com/Zeeeepa/codegen.py
Author: Codegen Team
Author-email: support@codegen.com
Project-URL: Bug Reports, https://github.com/Zeeeepa/codegen.py/issues
Project-URL: Source, https://github.com/Zeeeepa/codegen.py
Project-URL: Documentation, https://docs.codegen.com
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.7
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Requires-Python: >=3.7
Description-Content-Type: text/markdown
Requires-Dist: requests>=2.25.0
Requires-Dist: pyyaml>=5.4.0
Provides-Extra: dev
Requires-Dist: pytest>=6.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.18.0; extra == "dev"
Requires-Dist: black>=21.0.0; extra == "dev"
Requires-Dist: flake8>=3.9.0; extra == "dev"
Dynamic: author
Dynamic: author-email
Dynamic: classifier
Dynamic: description
Dynamic: description-content-type
Dynamic: home-page
Dynamic: project-url
Dynamic: provides-extra
Dynamic: requires-dist
Dynamic: requires-python
Dynamic: summary

# Codegen Python SDK

A comprehensive Python SDK for interacting with the Codegen AI agents API. This SDK provides both a programmatic interface and a command-line tool for managing AI agent tasks.

## üöÄ Features

- **Official SDK Interface**: Compatible with the official Codegen Python SDK
- **Full API Coverage**: Supports all Codegen API endpoints
- **Command Line Interface**: Rich CLI for task management
- **Type Safety**: Full type hints and validation
- **Error Handling**: Comprehensive error handling with detailed messages
- **Logging**: Detailed request/response logging for debugging
- **Caching**: Smart caching for improved performance

## üì¶ Installation

```bash
# Install dependencies
pip install -r requirements.txt

# Make the CLI available globally
chmod +x cli.py
ln -s $(pwd)/cli.py /usr/local/bin/codegenapi
```

## üìÅ Project Structure

```
codegen.py/
‚îú‚îÄ‚îÄ codegen_api.py              # Core SDK with enhanced logging
‚îú‚îÄ‚îÄ cli.py                      # Command-line interface
‚îú‚îÄ‚îÄ setup.py                    # Package configuration
‚îú‚îÄ‚îÄ requirements.txt            # Dependencies
‚îú‚îÄ‚îÄ README.md                   # This documentation
‚îú‚îÄ‚îÄ TESTING_RESULTS.md          # Comprehensive test results
‚îî‚îÄ‚îÄ tests/                      # Test suite
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ test_sdk.py             # Core SDK tests
    ‚îú‚îÄ‚îÄ comprehensive_test.py   # Integration tests
    ‚îî‚îÄ‚îÄ test_enhanced_logging.py # Enhanced logging tests
```

## üîß Configuration

### Environment Variables

```bash
export CODEGEN_API_TOKEN="your_api_token_here"
export CODEGEN_ORG_ID="your_org_id"
```

### CLI Configuration

```bash
# Configure via CLI
codegenapi config --token your_api_token --org-id your_org_id

# Or specify custom base URL
codegenapi config --token your_api_token --org-id your_org_id --base-url https://api.codegen.com
```

## üíª SDK Usage

### Basic Example

```python
from codegen_api import Agent

# Initialize the Agent
agent = Agent(
    token="your_api_token_here",
    org_id=323,  # Your organization ID
    base_url="https://api.codegen.com"  # Optional - defaults to this URL
)

# Run an agent with a prompt
task = agent.run(prompt="Which github repos can you currently access?")

# Check the initial status
print(task.status)  # Returns the current status (e.g., "ACTIVE", "COMPLETE", etc.)

# Refresh the task to get updated status
task.refresh()

# Once task is complete, you can access the result
if task.status == "COMPLETE":
    print(task.result)
    print(f"View details: {task.web_url}")
```

### Advanced Usage

```python
from codegen_api import Agent, CodegenAPIError
import time

# Initialize agent
agent = Agent(token="your_token", org_id=323)

try:
    # Create task with metadata
    task = agent.run(
        prompt="Analyze the codebase structure",
        metadata={"project": "my-project", "priority": "high"}
    )
    
    # Wait for completion with polling
    while task.status in ["ACTIVE", "PENDING"]:
        print(f"Status: {task.status}")
        time.sleep(5)
        task.refresh()
    
    # Handle completion
    if task.status == "COMPLETE":
        print("‚úÖ Task completed!")
        print(f"Result: {task.result}")
        
        # Check for pull requests
        if task.github_pull_requests:
            for pr in task.github_pull_requests:
                print(f"PR created: {pr.title} - {pr.url}")
    
except CodegenAPIError as e:
    print(f"API Error: {e.message}")
```

## üñ•Ô∏è CLI Usage

### Configuration

```bash
# Set up your credentials
codegenapi config --token sk-your-token --org-id 323

# Verify configuration
codegenapi config --show
```

### Creating Tasks

```bash
# Create a new task
codegenapi new \
  --repo https://github.com/user/repo \
  --task FEATURE_IMPLEMENTATION \
  --query "Add user authentication system"

# With optional parameters
codegenapi new \
  --repo https://github.com/user/repo \
  --branch feature/auth \
  --pr 123 \
  --task BUG_FIX \
  --query "Fix login validation issue"
```

### Managing Tasks

```bash
# Check task status
codegenapi status --task-id 12345

# List recent tasks
codegenapi list

# View task logs with comprehensive analysis
codegenapi logs --task-id 12345

# Resume a paused task
codegenapi resume --task-id 12345 --query "Continue with the implementation"
```

## üìä **Enhanced Logging with Outcome Detection**

The SDK provides **intelligent log analysis** that automatically detects what your agent accomplished:

### **Automatic Outcome Detection**
```bash
codegenapi logs --task-id 12345
```

**Example Output:**
```
üìã Logs for task 12345:
üìä Status: completed
üìÑ Total logs: 25
üéØ Outcomes: ‚úÖ PR-Created ‚úÖ | üß™ Plan-Created üß™ | üíª Code-Generated üíª
   üìã PRs: https://github.com/user/repo/pull/456
   üìù Plans: implementation-plan.md, roadmap.md
   üíª Code: src/auth.js, src/middleware.js, tests/auth.test.js
üîß Tools used: create_pr, file_write, text_editor, ripgrep_search

 1. [10:30:15] ‚ö° ACTION
    üí≠ I need to create a pull request for these changes
    üîß Tool: create_pr
    üì• Input: title=Fix authentication bug
    üì§ Output: üîó https://github.com/user/repo/pull/456
    üëÅÔ∏è  Observation: Successfully created PR #456
```

### **Supported Outcome Types**
- ‚úÖ **PR-Created** - Automatically detects pull request creation
- üß™ **Plan-Created** - Identifies plans, roadmaps, and strategy documents  
- üíª **Code-Generated** - Tracks code file creation and modifications
- üìö **Docs-Created** - Notices documentation and README updates
- ‚ùå **Errors-Found** - Highlights any errors encountered during execution

### **Rich Log Analysis Features**
- **Agent Reasoning**: See the agent's thought process at each step
- **Tool Execution**: Detailed input/output for every tool used
- **Smart Truncation**: Long content is intelligently summarized
- **Context Awareness**: Logs are formatted based on their type and content
- **Error Tracking**: Comprehensive error detection and reporting

### Available Task Types

- **Planning & Analysis**: `PLAN_CREATION`, `PLAN_EVALUATION`, `CODEBASE_ANALYSIS`
- **Development**: `FEATURE_IMPLEMENTATION`, `BUG_FIX`, `CODE_RESTRUCTURE`
- **Testing**: `TEST_GENERATION`, `TEST_COVERAGE_IMPROVEMENT`
- **Documentation**: `DOCUMENTATION_GENERATION`, `CODE_COMMENTS`
- **DevOps**: `CI_CD_SETUP`, `GITHUB_WORKFLOW_CREATION`, `DOCKER_CONFIGURATION`
- **Integration**: `THIRD_PARTY_INTEGRATION`

## üß™ Testing

The SDK includes a comprehensive test suite located in the `tests/` directory:

```bash
# Run all tests
python -m pytest tests/

# Run specific test files
python tests/test_sdk.py                    # Core SDK functionality
python tests/comprehensive_test.py         # Full integration tests
python tests/test_enhanced_logging.py      # Enhanced logging system
```

### Test Coverage
- ‚úÖ **Core SDK**: Agent initialization, task execution, status monitoring
- ‚úÖ **Enhanced Logging**: Outcome detection, log analysis, CLI formatting
- ‚úÖ **CLI Interface**: All commands and error handling
- ‚úÖ **API Client**: HTTP operations, authentication, error handling
- ‚úÖ **Integration**: End-to-end workflows and edge cases

### Running Tests
```bash
# Install test dependencies
pip install pytest

# Run all tests with verbose output
python -m pytest tests/ -v

# Run tests with coverage
python -m pytest tests/ --cov=codegen_api --cov=cli
```

## üèóÔ∏è API Reference

### Agent Class

```python
class Agent:
    def __init__(self, token: str, org_id: Optional[int] = None, base_url: Optional[str] = None)
    def run(self, prompt: str) -> AgentTask
    def get_status(self) -> Optional[Dict[str, Any]]
```

### AgentTask Class

```python
class AgentTask:
    id: int
    org_id: int
    status: str
    result: Optional[str]
    web_url: Optional[str]
    github_pull_requests: Optional[List[GitHubPullRequest]]
    
    def refresh(self) -> None
```

### Error Handling

```python
from codegen_api import CodegenAPIError, ValidationError

try:
    task = agent.run(prompt="")  # Empty prompt
except ValidationError as e:
    print(f"Validation error: {e.message}")
except CodegenAPIError as e:
    print(f"API error: {e.message}")
    print(f"Status code: {e.status_code}")
```

## üîç Debugging

### Enable Detailed Logging

```python
import logging
logging.basicConfig(level=logging.DEBUG)

# Now all API requests will be logged with full details
agent = Agent(token="your_token", org_id=323)
```

### Test Mode

```bash
# Run CLI commands in test mode (no actual API calls)
codegenapi new --test-mode --repo test --task CODEBASE_ANALYSIS --query "test"
```

## üìä Examples

### Example 1: Simple Code Analysis

```python
from codegen_api import Agent
import time

agent = Agent(token="your_token", org_id=323)
task = agent.run(prompt="Analyze the main.py file and suggest improvements")

# Wait for completion
while task.status == "ACTIVE":
    time.sleep(5)
    task.refresh()

print(f"Analysis complete: {task.result}")
```

### Example 2: Feature Implementation

```bash
codegenapi new \
  --repo https://github.com/myorg/myproject \
  --task FEATURE_IMPLEMENTATION \
  --query "Implement user registration with email verification"
```

### Example 3: Bug Fix with PR Context

```bash
codegenapi new \
  --repo https://github.com/myorg/myproject \
  --pr 456 \
  --task BUG_FIX \
  --query "Fix the memory leak in the data processing pipeline"
```

## üõ†Ô∏è Development

### Running Tests

```bash
# Run the comprehensive test suite
python3 comprehensive_test.py

# Test the SDK interface
python3 test_sdk.py

# Test CLI functionality
codegenapi --help
```

### Project Structure

```
‚îú‚îÄ‚îÄ codegen_api.py          # Main SDK implementation
‚îú‚îÄ‚îÄ cli.py                  # Command-line interface
‚îú‚îÄ‚îÄ comprehensive_test.py   # Full test suite
‚îú‚îÄ‚îÄ test_sdk.py            # SDK interface tests
‚îú‚îÄ‚îÄ requirements.txt       # Dependencies
‚îî‚îÄ‚îÄ README.md             # This file
```

## üîó API Endpoints

The SDK covers all Codegen API endpoints:

- `POST /v1/organizations/{org_id}/agent/run` - Create agent run
- `GET /v1/organizations/{org_id}/agent/run/{agent_run_id}` - Get agent run
- `GET /v1/organizations/{org_id}/agent/runs` - List agent runs
- `POST /v1/organizations/{org_id}/agent/run/resume` - Resume agent run
- `GET /v1/organizations/{org_id}/agent/run/{agent_run_id}/logs` - Get agent run logs

## üéØ Current Status

‚úÖ **Working Features:**
- Agent initialization and configuration
- Task creation and status checking
- CLI commands (config, new, status, list, resume)
- Error handling and validation
- API connectivity with https://api.codegen.com
- Task polling and completion detection

‚ö†Ô∏è **Known Issues:**
- Logs endpoint may return 404 for some tasks (API limitation)
- Some task statuses use different casing (ACTIVE vs active)

## üìù License

This project is licensed under the MIT License.

## ü§ù Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests
5. Submit a pull request

## üìû Support

For support and questions:
- Check the [Codegen Documentation](https://docs.codegen.com)
- Open an issue on GitHub
- Contact support at support@codegen.com
