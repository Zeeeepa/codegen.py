Metadata-Version: 2.4
Name: codegenapi
Version: 1.0.0
Summary: Python SDK and CLI for Codegen Agents
Home-page: https://github.com/Zeeeepa/codegen.py
Author: Codegen Team
Author-email: support@codegen.com
Project-URL: Bug Reports, https://github.com/Zeeeepa/codegen.py/issues
Project-URL: Source, https://github.com/Zeeeepa/codegen.py
Project-URL: Documentation, https://docs.codegen.com
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.7
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Requires-Python: >=3.7
Description-Content-Type: text/markdown
Requires-Dist: requests>=2.25.0
Requires-Dist: pyyaml>=5.4.0
Provides-Extra: dev
Requires-Dist: pytest>=6.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.18.0; extra == "dev"
Requires-Dist: black>=21.0.0; extra == "dev"
Requires-Dist: flake8>=3.9.0; extra == "dev"
Dynamic: author
Dynamic: author-email
Dynamic: classifier
Dynamic: description
Dynamic: description-content-type
Dynamic: home-page
Dynamic: project-url
Dynamic: provides-extra
Dynamic: requires-dist
Dynamic: requires-python
Dynamic: summary

# Codegen Python SDK

A comprehensive Python SDK for interacting with the Codegen AI agents API. This SDK provides both a programmatic interface and a command-line tool for managing AI agent tasks.

## ğŸš€ Features

- **Official SDK Interface**: Compatible with the official Codegen Python SDK
- **Full API Coverage**: Supports all Codegen API endpoints
- **Command Line Interface**: Rich CLI for task management
- **Type Safety**: Full type hints and validation
- **Error Handling**: Comprehensive error handling with detailed messages
- **Logging**: Detailed request/response logging for debugging
- **Caching**: Smart caching for improved performance

## ğŸ“¦ Installation

```bash
# Install dependencies
pip install -r requirements.txt

# Make the CLI available globally
chmod +x cli.py
ln -s $(pwd)/cli.py /usr/local/bin/codegenapi
```

## ğŸ“ Project Structure

```
codegen.py/
â”œâ”€â”€ codegen_api.py              # Core SDK with enhanced logging
â”œâ”€â”€ cli.py                      # Command-line interface
â”œâ”€â”€ setup.py                    # Package configuration
â”œâ”€â”€ requirements.txt            # Dependencies
â”œâ”€â”€ README.md                   # This documentation
â”œâ”€â”€ TESTING_RESULTS.md          # Comprehensive test results
â””â”€â”€ tests/                      # Test suite
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ test_sdk.py             # Core SDK tests
    â”œâ”€â”€ comprehensive_test.py   # Integration tests
    â””â”€â”€ test_enhanced_logging.py # Enhanced logging tests
```

## ğŸ”§ Configuration

### Environment Variables

```bash
export CODEGEN_API_TOKEN="your_api_token_here"
export CODEGEN_ORG_ID="your_org_id"
```

### CLI Configuration

```bash
# Configure via CLI
codegenapi config --token your_api_token --org-id your_org_id

# Or specify custom base URL
codegenapi config --token your_api_token --org-id your_org_id --base-url https://api.codegen.com
```

## ğŸ’» SDK Usage

### Basic Example

```python
from codegen_api import Agent

# Initialize the Agent
agent = Agent(
    token="your_api_token_here",
    org_id=323,  # Your organization ID
    base_url="https://api.codegen.com"  # Optional - defaults to this URL
)

# Run an agent with a prompt
task = agent.run(prompt="Which github repos can you currently access?")

# Check the initial status
print(task.status)  # Returns the current status (e.g., "ACTIVE", "COMPLETE", etc.)

# Refresh the task to get updated status
task.refresh()

# Once task is complete, you can access the result
if task.status == "COMPLETE":
    print(task.result)
    print(f"View details: {task.web_url}")
```

### Advanced Usage

```python
from codegen_api import Agent, CodegenAPIError
import time

# Initialize agent
agent = Agent(token="your_token", org_id=323)

try:
    # Create task with metadata
    task = agent.run(
        prompt="Analyze the codebase structure",
        metadata={"project": "my-project", "priority": "high"}
    )
    
    # Wait for completion with polling
    while task.status in ["ACTIVE", "PENDING"]:
        print(f"Status: {task.status}")
        time.sleep(5)
        task.refresh()
    
    # Handle completion
    if task.status == "COMPLETE":
        print("âœ… Task completed!")
        print(f"Result: {task.result}")
        
        # Check for pull requests
        if task.github_pull_requests:
            for pr in task.github_pull_requests:
                print(f"PR created: {pr.title} - {pr.url}")
    
except CodegenAPIError as e:
    print(f"API Error: {e.message}")
```

## ğŸ–¥ï¸ CLI Usage

### Configuration

```bash
# Set up your credentials
codegenapi config --token sk-your-token --org-id 323

# Verify configuration
codegenapi config --show
```

### Creating Tasks

```bash
# Create a new task
codegenapi new \
  --repo https://github.com/user/repo \
  --task FEATURE_IMPLEMENTATION \
  --query "Add user authentication system"

# With optional parameters
codegenapi new \
  --repo https://github.com/user/repo \
  --branch feature/auth \
  --pr 123 \
  --task BUG_FIX \
  --query "Fix login validation issue"
```

### Managing Tasks

```bash
# Check task status
codegenapi status --task-id 12345

# List recent tasks
codegenapi list

# View task logs with comprehensive analysis
codegenapi logs --task-id 12345

# Resume a paused task
codegenapi resume --task-id 12345 --query "Continue with the implementation"
```

## ğŸ“Š **Enhanced Logging with Outcome Detection**

The SDK provides **intelligent log analysis** that automatically detects what your agent accomplished:

### **Automatic Outcome Detection**
```bash
codegenapi logs --task-id 12345
```

**Example Output:**
```
ğŸ“‹ Logs for task 12345:
ğŸ“Š Status: completed
ğŸ“„ Total logs: 25
ğŸ¯ Outcomes: âœ… PR-Created âœ… | ğŸ§ª Plan-Created ğŸ§ª | ğŸ’» Code-Generated ğŸ’»
   ğŸ“‹ PRs: https://github.com/user/repo/pull/456
   ğŸ“ Plans: implementation-plan.md, roadmap.md
   ğŸ’» Code: src/auth.js, src/middleware.js, tests/auth.test.js
ğŸ”§ Tools used: create_pr, file_write, text_editor, ripgrep_search

 1. [10:30:15] âš¡ ACTION
    ğŸ’­ I need to create a pull request for these changes
    ğŸ”§ Tool: create_pr
    ğŸ“¥ Input: title=Fix authentication bug
    ğŸ“¤ Output: ğŸ”— https://github.com/user/repo/pull/456
    ğŸ‘ï¸  Observation: Successfully created PR #456
```

### **Supported Outcome Types**
- âœ… **PR-Created** - Automatically detects pull request creation
- ğŸ§ª **Plan-Created** - Identifies plans, roadmaps, and strategy documents  
- ğŸ’» **Code-Generated** - Tracks code file creation and modifications
- ğŸ“š **Docs-Created** - Notices documentation and README updates
- âŒ **Errors-Found** - Highlights any errors encountered during execution

### **Rich Log Analysis Features**
- **Agent Reasoning**: See the agent's thought process at each step
- **Tool Execution**: Detailed input/output for every tool used
- **Smart Truncation**: Long content is intelligently summarized
- **Context Awareness**: Logs are formatted based on their type and content
- **Error Tracking**: Comprehensive error detection and reporting

### Available Task Types

- **Planning & Analysis**: `PLAN_CREATION`, `PLAN_EVALUATION`, `CODEBASE_ANALYSIS`
- **Development**: `FEATURE_IMPLEMENTATION`, `BUG_FIX`, `CODE_RESTRUCTURE`
- **Testing**: `TEST_GENERATION`, `TEST_COVERAGE_IMPROVEMENT`
- **Documentation**: `DOCUMENTATION_GENERATION`, `CODE_COMMENTS`
- **DevOps**: `CI_CD_SETUP`, `GITHUB_WORKFLOW_CREATION`, `DOCKER_CONFIGURATION`
- **Integration**: `THIRD_PARTY_INTEGRATION`

## ğŸ§ª Testing

The SDK includes a comprehensive test suite located in the `tests/` directory:

```bash
# Run all tests
python -m pytest tests/

# Run specific test files
python tests/test_sdk.py                    # Core SDK functionality
python tests/comprehensive_test.py         # Full integration tests
python tests/test_enhanced_logging.py      # Enhanced logging system
```

### Test Coverage
- âœ… **Core SDK**: Agent initialization, task execution, status monitoring
- âœ… **Enhanced Logging**: Outcome detection, log analysis, CLI formatting
- âœ… **CLI Interface**: All commands and error handling
- âœ… **API Client**: HTTP operations, authentication, error handling
- âœ… **Integration**: End-to-end workflows and edge cases

### Running Tests
```bash
# Install test dependencies
pip install pytest

# Run all tests with verbose output
python -m pytest tests/ -v

# Run tests with coverage
python -m pytest tests/ --cov=codegen_api --cov=cli
```

## ğŸ—ï¸ API Reference

### Agent Class

```python
class Agent:
    def __init__(self, token: str, org_id: Optional[int] = None, base_url: Optional[str] = None)
    def run(self, prompt: str) -> AgentTask
    def get_status(self) -> Optional[Dict[str, Any]]
```

### AgentTask Class

```python
class AgentTask:
    id: int
    org_id: int
    status: str
    result: Optional[str]
    web_url: Optional[str]
    github_pull_requests: Optional[List[GitHubPullRequest]]
    
    def refresh(self) -> None
```

### Error Handling

```python
from codegen_api import CodegenAPIError, ValidationError

try:
    task = agent.run(prompt="")  # Empty prompt
except ValidationError as e:
    print(f"Validation error: {e.message}")
except CodegenAPIError as e:
    print(f"API error: {e.message}")
    print(f"Status code: {e.status_code}")
```

## ğŸ” Debugging

### Enable Detailed Logging

```python
import logging
logging.basicConfig(level=logging.DEBUG)

# Now all API requests will be logged with full details
agent = Agent(token="your_token", org_id=323)
```

### Test Mode

```bash
# Run CLI commands in test mode (no actual API calls)
codegenapi new --test-mode --repo test --task CODEBASE_ANALYSIS --query "test"
```

## ğŸ“Š Examples

### Example 1: Simple Code Analysis

```python
from codegen_api import Agent
import time

agent = Agent(token="your_token", org_id=323)
task = agent.run(prompt="Analyze the main.py file and suggest improvements")

# Wait for completion
while task.status == "ACTIVE":
    time.sleep(5)
    task.refresh()

print(f"Analysis complete: {task.result}")
```

### Example 2: Feature Implementation

```bash
codegenapi new \
  --repo https://github.com/myorg/myproject \
  --task FEATURE_IMPLEMENTATION \
  --query "Implement user registration with email verification"
```

### Example 3: Bug Fix with PR Context

```bash
codegenapi new \
  --repo https://github.com/myorg/myproject \
  --pr 456 \
  --task BUG_FIX \
  --query "Fix the memory leak in the data processing pipeline"
```

## ğŸ› ï¸ Development

### Running Tests

```bash
# Run the comprehensive test suite
python3 comprehensive_test.py

# Test the SDK interface
python3 test_sdk.py

# Test CLI functionality
codegenapi --help
```

### Project Structure

```
â”œâ”€â”€ codegen_api.py          # Main SDK implementation
â”œâ”€â”€ cli.py                  # Command-line interface
â”œâ”€â”€ comprehensive_test.py   # Full test suite
â”œâ”€â”€ test_sdk.py            # SDK interface tests
â”œâ”€â”€ requirements.txt       # Dependencies
â””â”€â”€ README.md             # This file
```

## ğŸ”— API Endpoints

The SDK covers all Codegen API endpoints:

- `POST /v1/organizations/{org_id}/agent/run` - Create agent run
- `GET /v1/organizations/{org_id}/agent/run/{agent_run_id}` - Get agent run
- `GET /v1/organizations/{org_id}/agent/runs` - List agent runs
- `POST /v1/organizations/{org_id}/agent/run/resume` - Resume agent run
- `GET /v1/organizations/{org_id}/agent/run/{agent_run_id}/logs` - Get agent run logs

## ğŸ¯ Current Status

âœ… **Working Features:**
- Agent initialization and configuration
- Task creation and status checking
- CLI commands (config, new, status, list, resume)
- Error handling and validation
- API connectivity with https://api.codegen.com
- Task polling and completion detection

âš ï¸ **Known Issues:**
- Logs endpoint may return 404 for some tasks (API limitation)
- Some task statuses use different casing (ACTIVE vs active)

## ğŸ“ License

This project is licensed under the MIT License.

## ğŸ¤ Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests
5. Submit a pull request

## ğŸ“ Support

For support and questions:
- Check the [Codegen Documentation](https://docs.codegen.com)
- Open an issue on GitHub
- Contact support at support@codegen.com
